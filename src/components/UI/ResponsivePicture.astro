---
import { createCloudinaryUrl, isCloudinaryUrl, generateSrcSet } from '../../utils/cloudinary';

interface Props {
  src: string;
  alt?: string;
  class?: string;
  imageClass?: string;
}

const {
  src,
  alt = "",
  class: className = "",
  imageClass = "w-full h-full object-cover",
}: Props = Astro.props;

const isCloudinary = isCloudinaryUrl(src);
const widths = [480, 768, 1024, 1280];

const srcSet = generateSrcSet(src, widths);

const fallbackSrc = isCloudinary
  ? createCloudinaryUrl(src, ["f_auto", "q_auto"])
  : src;

const sizes = "(max-width: 768px) 100vw, 50vw";
---
<picture class={className}>
  {srcSet ? <source srcset={srcSet} sizes={sizes} /> : null}
  <img
    src={fallbackSrc}
    alt={alt}
    loading="lazy"
    decoding="async"
    class={imageClass}
  />
</picture>