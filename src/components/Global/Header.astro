---
import Navigation from "./Navigation.astro";
import { t, getCurrentLocaleFromAstro } from "../../i18n/index";
const locale = getCurrentLocaleFromAstro(Astro);
let siteTitle = "Astrology for the Future";
try {
  siteTitle = await t("site.title", locale);
} catch (e) {
  console.error("Error fetching site title:", e);
}

// Add TS declaration for global menu state
declare global {
  interface Window {
    __NAV_MENU_OPEN__?: boolean;
  }
}
---

<header class="font-sans sticky top-0 z-50 w-full bg-white backdrop-blur-md shadow-sm">
  <div class="container flex items-center justify-between h-20">
    <a href="/" class="text-2xl font-bold text-primary-800 flex items-center">
      <span class="sr-only">{siteTitle}</span>
      <!-- <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="h-12 w-auto text-primary-600 mr-2">
        <path fill="currentColor" d="M344 24c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 24-32 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l32 0 0 46.4L183.3 210c-14.5 8.7-23.3 24.3-23.3 41.2L160 512l96 0 0-96c0-35.3 28.7-64 64-64s64 28.7 64 64l0 96 96 0 0-260.8c0-16.9-8.8-32.5-23.3-41.2L344 142.4 344 96l32 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-32 0 0-24zM24.9 330.3C9.5 338.8 0 354.9 0 372.4L0 464c0 26.5 21.5 48 48 48l80 0 0-238.4L24.9 330.3zM592 512c26.5 0 48-21.5 48-48l0-91.6c0-17.5-9.5-33.6-24.9-42.1L512 273.6 512 512l80 0z"/>
      </svg> -->
      <span class="text-4xl">{siteTitle}</span>
    </a>

    <Navigation />
  </div>
</header>

<style>
  header {
    transition: transform 0.3s ease-in-out;
  }

  header.nav-hidden {
    transform: translateY(-100%);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const mainHeader = document.querySelector("header")!;

    // Hide on scroll down, show on scroll up
    let lastScrollTop = 0;
    const scrollThreshold = 100; // Only hide after scrolling 100px

    window.addEventListener(
      "scroll",
      () => {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        // Prevent nav from hiding if mobile menu is open
        if (window.__NAV_MENU_OPEN__) {
          mainHeader.classList.remove("nav-hidden");
          lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
          return;
        }

        if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
          // Scroll down
          mainHeader.classList.add("nav-hidden");
        } else {
          // Scroll up
          mainHeader.classList.remove("nav-hidden");
        }
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // For Mobile or negative scrolling
      },
      false
    );
  });
</script>
